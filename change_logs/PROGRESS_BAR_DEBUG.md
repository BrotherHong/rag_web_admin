# 進度條除錯指南

## 修改內容

### 1. 後端優化 (api.js)
- ✅ 立即設置 `fileTask.progress = 0` 當檔案開始處理時
- ✅ 進度從 10% 開始遞增（避免延遲後才顯示 0%）
- ✅ 每 10% 延遲 500ms
- ✅ 單個檔案處理時間：約 5 秒
- ✅ 添加控制台日誌追蹤每個檔案的進度

### 2. 前端優化 (UploadFiles.jsx)
- ✅ 輪詢間隔改為 500ms（0.5秒）
- ✅ 添加詳細的進度更新日誌

## 測試步驟

### 步驟 1：打開瀏覽器開發者工具
1. 按 `F12` 打開開發者工具
2. 切換到 **Console（控制台）** 標籤

### 步驟 2：上傳測試檔案
1. 選擇 2-3 個檔案進行測試
2. 點擊「下一步」檢查重複
3. 點擊「開始批次上傳」

### 步驟 3：觀察控制台輸出
您應該看到類似以下的日誌：

```
🚀 開始處理上傳任務: task_1_1729123456789 檔案數量: 3
📁 file1.pdf: 10%
📊 進度更新: { status: 'processing', processedFiles: 0, totalFiles: 3, files: [...] }
📁 file1.pdf: 20%
📊 進度更新: { status: 'processing', processedFiles: 0, totalFiles: 3, files: [...] }
📁 file1.pdf: 30%
...
📁 file1.pdf: 100%
📁 file2.pdf: 10%
📁 file2.pdf: 20%
...
```

### 步驟 4：觀察 UI 進度條
您應該看到：
- ✅ **總體進度條**：緩慢從 0% → 100%
- ✅ **檔案列表**：
  - 正在處理的檔案有藍色進度條，從 0% → 100%
  - 等待中的檔案顯示灰色時鐘圖示和「等待中」
  - 完成的檔案顯示綠色勾勾和「完成」

## 預期時間表

### 上傳 1 個檔案
- 總時間：約 5 秒
- 進度更新：0% → 10% → 20% → ... → 100%
- 每個步驟停留：0.5 秒

### 上傳 3 個檔案
- 總時間：約 15 秒
- 每個檔案依序處理
- 前端每 0.5 秒輪詢一次

### 上傳 10 個檔案
- 總時間：約 50 秒
- 每個檔案處理時都能看到完整進度

## 常見問題排查

### Q: 進度條沒有移動
**可能原因：**
1. 後端處理太快（延遲時間太短）
2. 前端輪詢間隔太長
3. React 狀態沒有正確更新

**解決方案：**
- 檢查控制台是否有 `📊 進度更新` 日誌
- 檢查是否有 `📁 檔案名: XX%` 日誌
- 如果有日誌但 UI 沒動，可能是 React 渲染問題

### Q: 只看到第一個檔案的部分進度，然後突然全部完成
**原因：** 後端處理速度 > 前端輪詢頻率

**已修復：**
- 後端延遲從 300ms 增加到 500ms
- 前端輪詢從 1000ms 減少到 500ms
- 單檔處理時間從 1.8秒 增加到 5秒

### Q: 進度條跳動或不流暢
**原因：** 輪詢間隔與後端更新頻率不匹配

**當前設定：**
- 後端每 500ms 更新一次進度（+10%）
- 前端每 500ms 輪詢一次
- 理論上每次輪詢都能捕捉到進度變化

## 性能建議

### 開發環境
- 延遲時間：500ms（當前設定）
- 進度步進：10%（當前設定）
- 輪詢間隔：500ms（當前設定）

### 生產環境（連接真實後端時）
- 移除所有 `console.log`
- 輪詢間隔可調整為 1000ms（1秒）
- 根據實際上傳速度調整

## 日誌說明

### 後端日誌
- `🚀 開始處理上傳任務` - 任務開始
- `📁 檔案名: XX%` - 每次進度更新

### 前端日誌
- `📊 進度更新` - 每次輪詢獲取到的完整進度資訊

## 下一步

如果進度條還是沒有動：
1. 複製控制台的所有日誌
2. 檢查是否有錯誤訊息
3. 確認 uploadProgress 狀態是否正確更新
4. 檢查瀏覽器是否有性能問題（CPU 過高）
