# ğŸ”§ RAG çŸ¥è­˜åº«ç®¡ç†ç³»çµ± - å¾Œç«¯ API å¯¦ä½œæ–‡ä»¶

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [API æ¸…å–®ç¸½è¦½](#api-æ¸…å–®ç¸½è¦½)
3. [èªè­‰èˆ‡æ¬Šé™](#èªè­‰èˆ‡æ¬Šé™)
4. [å›æ‡‰æ ¼å¼è¦ç¯„](#å›æ‡‰æ ¼å¼è¦ç¯„)
5. [éŒ¯èª¤è™•ç†](#éŒ¯èª¤è™•ç†)
6. [è©³ç´° API æ–‡ä»¶](#è©³ç´°-api-æ–‡ä»¶)

---

## ç³»çµ±æ¦‚è¿°

### æŠ€è¡“æ¶æ§‹
- **å‰ç«¯æ¡†æ¶**: React 19.1.1 + Vite 7.1.7
- **UI æ¡†æ¶**: Tailwind CSS 4.1.14
- **å¾Œç«¯éœ€æ±‚**: RESTful API
- **èªè­‰æ–¹å¼**: JWT Token (å»ºè­°)
- **è³‡æ–™æ ¼å¼**: JSON

### æ¬Šé™ç³»çµ± (RBAC)
ç³»çµ±å¯¦ä½œä¸‰ç´šæ¬Šé™æ§åˆ¶:

| è§’è‰² | æ¬Šé™ç´šåˆ¥ | èªªæ˜ | å¯åŸ·è¡Œæ“ä½œ |
|------|---------|------|-----------|
| **admin** | 3 | ç³»çµ±ç®¡ç†å“¡ | æ‰€æœ‰æ“ä½œï¼ˆåŒ…å«ä½¿ç”¨è€…ç®¡ç†ã€ç³»çµ±è¨­å®šï¼‰ |
| **manager** | 2 | æª”æ¡ˆç®¡ç†å“¡ | æª”æ¡ˆä¸Šå‚³/åˆªé™¤ã€åˆ†é¡ç®¡ç† |
| **viewer** | 1 | ä¸€èˆ¬æª¢è¦–è€… | åƒ…å¯æŸ¥çœ‹ï¼Œç„¡ä¿®æ”¹æ¬Šé™ |

### è³‡æ–™åº«çµæ§‹

ç³»çµ±éœ€è¦ä»¥ä¸‹è³‡æ–™è¡¨:

```
ğŸ“¦ Database Schema
â”œâ”€â”€ users          # ä½¿ç”¨è€…è³‡æ–™è¡¨
â”œâ”€â”€ categories     # åˆ†é¡è³‡æ–™è¡¨
â”œâ”€â”€ files          # æª”æ¡ˆè³‡æ–™è¡¨
â”œâ”€â”€ statistics     # çµ±è¨ˆè³‡æ–™è¡¨
â”œâ”€â”€ activities     # æ´»å‹•è¨˜éŒ„è¡¨
â”œâ”€â”€ settings       # ç³»çµ±è¨­å®šè¡¨
â””â”€â”€ upload_tasks   # ä¸Šå‚³ä»»å‹™è¡¨
```

---

## API æ¸…å–®ç¸½è¦½

ç³»çµ±å…±æœ‰ **28 å€‹ API ç«¯é»**ï¼Œåˆ†ç‚º 7 å¤§é¡:

### 1. èªè­‰ç›¸é—œ (3 å€‹)
- `POST /api/auth/login` - ä½¿ç”¨è€…ç™»å…¥
- `POST /api/auth/logout` - ä½¿ç”¨è€…ç™»å‡º
- `GET /api/auth/verify` - é©—è­‰ Token

### 2. æª”æ¡ˆç®¡ç† (5 å€‹)
- `GET /api/files` - å–å¾—æª”æ¡ˆåˆ—è¡¨
- `POST /api/files/upload` - ä¸Šå‚³æª”æ¡ˆ
- `DELETE /api/files/:id` - åˆªé™¤æª”æ¡ˆ
- `GET /api/files/:id/download` - ä¸‹è¼‰æª”æ¡ˆ
- `POST /api/files/check-duplicates` - æª¢æŸ¥é‡è¤‡æª”æ¡ˆ

### 3. æ‰¹æ¬¡ä¸Šå‚³ (3 å€‹)
- `POST /api/files/batch-upload` - æ‰¹æ¬¡ä¸Šå‚³æª”æ¡ˆ
- `GET /api/upload-tasks/:id` - å–å¾—ä¸Šå‚³é€²åº¦
- `GET /api/upload-tasks` - å–å¾—ä½¿ç”¨è€…ä¸Šå‚³ä»»å‹™
- `DELETE /api/upload-tasks/:id` - åˆªé™¤ä¸Šå‚³ä»»å‹™

### 4. çµ±è¨ˆèˆ‡æ´»å‹• (2 å€‹)
- `GET /api/statistics` - å–å¾—çµ±è¨ˆè³‡æ–™
- `GET /api/activities` - å–å¾—æ´»å‹•è¨˜éŒ„

### 5. åˆ†é¡ç®¡ç† (3 å€‹)
- `GET /api/categories` - å–å¾—åˆ†é¡åˆ—è¡¨
- `POST /api/categories` - æ–°å¢åˆ†é¡
- `DELETE /api/categories/:id` - åˆªé™¤åˆ†é¡

### 6. ä½¿ç”¨è€…ç®¡ç† (4 å€‹)
- `GET /api/users` - å–å¾—ä½¿ç”¨è€…åˆ—è¡¨
- `POST /api/users` - æ–°å¢ä½¿ç”¨è€…
- `PUT /api/users/:id` - æ›´æ–°ä½¿ç”¨è€…
- `DELETE /api/users/:id` - åˆªé™¤ä½¿ç”¨è€…

### 7. ç³»çµ±è¨­å®š (5 å€‹)
- `GET /api/settings` - å–å¾—ç³»çµ±è¨­å®š
- `PUT /api/settings` - æ›´æ–°ç³»çµ±è¨­å®š
- `GET /api/backups` - å–å¾—å‚™ä»½è¨˜éŒ„
- `POST /api/backups` - å»ºç«‹å‚™ä»½
- `POST /api/backups/:id/restore` - é‚„åŸå‚™ä»½
- `GET /api/system/info` - å–å¾—ç³»çµ±è³‡è¨Š

---

## èªè­‰èˆ‡æ¬Šé™

### JWT Token è¦ç¯„

**Token å„²å­˜ä½ç½®**: `localStorage.user`

**Token å…§å®¹æ ¼å¼**:
```json
{
  "id": 1,
  "username": "admin",
  "name": "ç³»çµ±ç®¡ç†å“¡",
  "email": "admin@ncku.edu.tw",
  "role": "admin",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresAt": "2025-10-18T23:59:59Z"
}
```

### æ¬Šé™é©—è­‰æµç¨‹

æ¯å€‹éœ€è¦æ¬Šé™çš„ API éƒ½æ‡‰åŸ·è¡Œä»¥ä¸‹æª¢æŸ¥:

```javascript
// 1. é©—è­‰ Token æ˜¯å¦æœ‰æ•ˆ
if (!token || isExpired(token)) {
  return { success: false, message: 'æœªç™»å…¥æˆ– Token å·²éæœŸ' };
}

// 2. æª¢æŸ¥ä½¿ç”¨è€…æ¬Šé™ç´šåˆ¥
const roleHierarchy = { admin: 3, manager: 2, viewer: 1 };
const userLevel = roleHierarchy[user.role];
const requiredLevel = roleHierarchy[requiredRole];

if (userLevel < requiredLevel) {
  return { success: false, message: 'æ¬Šé™ä¸è¶³' };
}

// 3. åŸ·è¡Œæ“ä½œ
```

### å„ API æ¬Šé™è¦æ±‚

| æ“ä½œé¡å‹ | éœ€è¦æ¬Šé™ | é©ç”¨ API |
|---------|---------|---------|
| æŸ¥çœ‹è³‡æ–™ | viewer (1) | GET ç³»åˆ— |
| æª”æ¡ˆä¸Šå‚³/åˆªé™¤ | manager (2) | POST/DELETE /files |
| åˆ†é¡ç®¡ç† | manager (2) | POST/DELETE /categories |
| ä½¿ç”¨è€…ç®¡ç† | admin (3) | /users/* |
| ç³»çµ±è¨­å®š | admin (3) | /settings, /backups |

---

## å›æ‡‰æ ¼å¼è¦ç¯„

### æˆåŠŸå›æ‡‰

```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸè¨Šæ¯ï¼ˆé¸å¡«ï¼‰"
}
```

### å¤±æ•—å›æ‡‰

```json
{
  "success": false,
  "message": "éŒ¯èª¤è¨Šæ¯",
  "error": "è©³ç´°éŒ¯èª¤è³‡è¨Šï¼ˆé¸å¡«ï¼‰"
}
```

### åˆ†é å›æ‡‰

```json
{
  "success": true,
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "pageSize": 10,
      "total": 100,
      "totalPages": 10
    }
  }
}
```

---

## éŒ¯èª¤è™•ç†

### HTTP ç‹€æ…‹ç¢¼

| ç‹€æ…‹ç¢¼ | èªªæ˜ | ä½¿ç”¨æƒ…å¢ƒ |
|-------|------|---------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| 201 | å·²å»ºç«‹ | æˆåŠŸå»ºç«‹æ–°è³‡æº |
| 400 | éŒ¯èª¤è«‹æ±‚ | åƒæ•¸é©—è­‰å¤±æ•— |
| 401 | æœªæˆæ¬Š | æœªç™»å…¥æˆ– Token ç„¡æ•ˆ |
| 403 | ç¦æ­¢å­˜å– | æ¬Šé™ä¸è¶³ |
| 404 | æ‰¾ä¸åˆ° | è³‡æºä¸å­˜åœ¨ |
| 409 | è¡çª | è³‡æ–™é‡è¤‡ï¼ˆå¦‚ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨ï¼‰ |
| 500 | ä¼ºæœå™¨éŒ¯èª¤ | å…§éƒ¨éŒ¯èª¤ |

### å¸¸è¦‹éŒ¯èª¤è¨Šæ¯

```javascript
// èªè­‰éŒ¯èª¤
{ success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' }
{ success: false, message: 'æœªç™»å…¥æˆ– Token å·²éæœŸ' }
{ success: false, message: 'æ¬Šé™ä¸è¶³ï¼Œæ­¤æ“ä½œéœ€è¦æ›´é«˜æ¬Šé™' }

// è³‡æ–™é©—è­‰éŒ¯èª¤
{ success: false, message: 'å¿…å¡«æ¬„ä½ä¸èƒ½ç‚ºç©º' }
{ success: false, message: 'ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨' }
{ success: false, message: 'æª”æ¡ˆå¤§å°è¶…éé™åˆ¶' }

// è³‡æºéŒ¯èª¤
{ success: false, message: 'æ‰¾ä¸åˆ°æŒ‡å®šçš„æª”æ¡ˆ' }
{ success: false, message: 'åˆ†é¡ä¸å­˜åœ¨' }
{ success: false, message: 'ç„¡æ³•åˆªé™¤é è¨­åˆ†é¡' }
```

---

## è©³ç´° API æ–‡ä»¶

è©³ç´°çš„ API è¦æ ¼è«‹åƒè€ƒ:
- [èªè­‰ API](./BACKEND_API_AUTH.md)
- [æª”æ¡ˆç®¡ç† API](./BACKEND_API_FILES.md)
- [åˆ†é¡ç®¡ç† API](./BACKEND_API_CATEGORIES.md)
- [ä½¿ç”¨è€…ç®¡ç† API](./BACKEND_API_USERS.md)
- [ç³»çµ±è¨­å®š API](./BACKEND_API_SETTINGS.md)
- [çµ±è¨ˆèˆ‡æ´»å‹• API](./BACKEND_API_STATS.md)

---

## è³‡æ–™è¡¨çµæ§‹

è«‹åƒè€ƒ: [è³‡æ–™åº« Schema æ–‡ä»¶](./BACKEND_DATABASE_SCHEMA.md)

---

## å¯¦ä½œå»ºè­°

### 1. å®‰å…¨æ€§
- âœ… ä½¿ç”¨ HTTPS
- âœ… å¯¦ä½œ JWT Token ä¸¦è¨­å®šåˆç†çš„éæœŸæ™‚é–“
- âœ… å¯†ç¢¼ä½¿ç”¨ bcrypt æˆ– argon2 åŠ å¯†
- âœ… å¯¦ä½œ Rate Limiting é˜²æ­¢ API æ¿«ç”¨
- âœ… æª”æ¡ˆä¸Šå‚³éœ€é©—è­‰æª”æ¡ˆé¡å‹å’Œå¤§å°
- âœ… SQL Injection é˜²è­·

### 2. æ•ˆèƒ½å„ªåŒ–
- âœ… è³‡æ–™åº«æŸ¥è©¢ä½¿ç”¨ç´¢å¼•
- âœ… å¤§é‡è³‡æ–™ä½¿ç”¨åˆ†é 
- âœ… æª”æ¡ˆä¸Šå‚³æ”¯æ´ä¸²æµè™•ç†
- âœ… å¯¦ä½œå¿«å–æ©Ÿåˆ¶ï¼ˆå¦‚ Redisï¼‰

### 3. æª”æ¡ˆè™•ç†
- âœ… æª”æ¡ˆå„²å­˜ä½¿ç”¨é›²ç«¯æœå‹™ï¼ˆS3, Azure Blobï¼‰æˆ–å°ˆç”¨æª”æ¡ˆä¼ºæœå™¨
- âœ… æª”æ¡ˆè·¯å¾‘ä½¿ç”¨ UUID é¿å…é‡è¤‡
- âœ… å¯¦ä½œæª”æ¡ˆæƒæï¼ˆé˜²æ¯’ï¼‰
- âœ… æ”¯æ´æ–·é»çºŒå‚³

### 4. æ—¥èªŒèˆ‡ç›£æ§
- âœ… è¨˜éŒ„æ‰€æœ‰ API è«‹æ±‚
- âœ… è¨˜éŒ„ä½¿ç”¨è€…æ“ä½œæ´»å‹•
- âœ… å¯¦ä½œå¥åº·æª¢æŸ¥ç«¯é»
- âœ… ç›£æ§ç³»çµ±è³‡æºä½¿ç”¨

---

**æ–‡ä»¶ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-18  
**ç¶­è­·åœ˜éšŠ**: NCKU RAG System Development Team
